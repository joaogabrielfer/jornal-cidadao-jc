<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Jornal Cidadão - Minhas Notícias</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/css/jcstyle.css">
    <!-- COPIE E COLE SEU BLOCO <style> GIGANTE AQUI -->
    <style>
        /* ... SEU BLOCO <style> ORIGINAL VAI AQUI ... */
        /* ====== AJUSTES DO HEADER DO INDEX PARA ESTA PÁGINA ====== */

        #header-top-container {
            width: 100%;
            background: #ffffff;
        }

        #wrapper-header-searchbar {
            background: #ffffff;
        }

        #header .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        #header .row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        #header .col-xs-4.col-md-4 {
            flex: 0 0 33.3333%;
            max-width: 33.3333%;
        }

        #header .edition,
        #header .logo,
        #header .options {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #header .edition h5 {
            margin: 0 0 0 8px;
            font-size: 16px;
            font-weight: bold;
        }

        #header .logo figure {
            margin: 0;
            text-align: center;
        }

        #header .logo figcaption {
            margin-top: 4px;
            font-size: 14px;
        }

        #header .options {
            gap: 16px;
            justify-content: flex-end;
        }

        #header .btn-publicidade-legal {
            font-size: 14px;
            padding: 6px 16px;
            border-radius: 999px;
            border: 1px solid #d9272e;
            background: #ffffff;
            color: #d9272e;
            text-decoration: none;
        }

        #header .options img {
            display: block;
        }

        /* =========================================
           MENU LATERAL – MESMO VISUAL DO SITE
           ========================================= */

        /* overlay cinza atrás do menu */
        .jc-menu-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 9998;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .jc-menu-overlay.is-open {
            opacity: 1;
            pointer-events: auto;
        }

        /* menu lateral vindo da direita */
        body#jc .side-scroll.scroll-JC {
            position: fixed;
            top: 0;
            right: 0;
            width: 345px;
            max-width: 90%;
            height: 100vh;
            background: #ffffff;
            z-index: 9999;
            overflow-y: auto;
            box-shadow: -2px 0 8px rgba(0,0,0,0.3);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        body#jc .side-scroll.scroll-JC.is-open {
            transform: translateX(0);
        }

        /* topo: barra “AO VIVO” e X vermelho */
        .jc-menu-topbar {
            display: flex;
            justify-content: space-between;
            align-items: stretch;
            background: #2c2c2c;
            color: #ffffff;
        }

        .jc-menu-live-btn {
            flex: 1;
            border: none;
            background: transparent;
            color: #ffffff;
            font-weight: bold;
            padding: 12px 16px;
            text-align: left;
            cursor: pointer;
        }

        .jc-menu-close-btn {
            width: 88px;
            background: #d9272e;
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
        }

        /* bloco AO VIVO (lista interna) */
        .side-scroll.scroll-JC .lives {
            padding: 0 18px 10px;
        }

        .side-scroll.scroll-JC .lives ul {
            margin: 0;
            padding-left: 18px;
        }

        .side-scroll.scroll-JC .lives ul li a {
            font-size: 14px;
        }

        /* lista principal de links */
        .side-scroll.scroll-JC nav {
            padding: 10px 24px 32px;
        }

        .side-scroll.scroll-JC nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .side-scroll.scroll-JC nav li {
            margin: 10px 0;
        }

        .side-scroll.scroll-JC nav a {
            display: block;
            text-decoration: none;
            color: #111111;
            font-size: 16px;
        }

        .side-scroll.scroll-JC nav a:hover {
            color: #d9272e;
        }

        /* ====== LAYOUT GERAL DO DASHBOARD ====== */

        body#jc {
            background: #ffffff;
        }

        main.jc-dashboard {
            max-width: 100%;
            width: 100%;
            margin: 0 auto 80px;
            padding: 40px 120px;
            display: flex;
            flex-wrap: wrap; /* Permite que o carrossel quebre a linha */
            gap: 32px;
            background: #f4f4f4;
            box-sizing: border-box;
        }

        .jc-main-column {
            flex: 0 0 78%;
        }

        .jc-sidebar {
            flex: 0 0 22%;
        }

        /* ====== HEADER DO DASHBOARD JORNAL CIDADÃO ====== */

        .jc-dashboard-header {
            background: #ffffff;
            border-bottom: 1px solid #cccccc;
        }

        .jc-dashboard-header-inner {
            max-width: 1360px;
            margin: 0 auto;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-sizing: border-box;
        }

        .jc-nav-links {
            display: flex;
            gap: 18px;
            font-size: 14px;
            justify-content: center;
            flex: 1;
        }

        .jc-nav-link {
            text-decoration: none;
            color: #111111;
            font-weight: bold;
        }

        .jc-nav-link-active {
            border-bottom: 2px solid #d9272e;
            padding-bottom: 2px;
        }

        .jc-header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: auto;         /* joga tudo pra direita */
            justify-content: flex-end; /* garante alinhamento à direita */
        }

        .jc-btn-primary {
            background: #d9272e;
            color: #ffffff;
            border: none;
            padding: 7px 14px;
            font-size: 13px;
            font-weight: bold;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            cursor: pointer;
            border-radius: 0;
        }

        .jc-link-sair {
            font-size: 13px;
            color: #333333;
            text-decoration: none;
        }

        /* ====== COLUNA ESQUERDA – MINHAS NOTÍCIAS ====== */

        .jc-section-title {
            font-size: 20px;
            font-weight: bold;
            color: #111111;
            margin: 0 0 12px;
        }

        .jc-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .jc-filter-btn {
            border-radius: 0;
            border: 1px solid transparent;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            background: #ffffff;
            color: #333333;
        }
        
        /* CORREÇÃO: Status de acordo com o Model do Go */
        .jc-filter-btn[data-status="Em análise"],
        .jc-status-Em_análise {
            border-color: #f5a623;
            background: #fff3df;
            color: #a96508;
        }
        .jc-filter-btn[data-status="Aprovado"],
        .jc-status-Aprovado {
            border-color: #4caf50;
            background: #e7f6e8;
            color: #256428;
        }
        .jc-filter-btn[data-status="Rejeitada"],
        .jc-status-Rejeitada {
            border-color: #d0021b;
            background: #ffe6e8;
            color: #8a0010;
        }
        
        .jc-filter-btn.jc-filter-active {
            border-width: 2px;
        }

        .jc-news-list {
            background: #ffffff;
            border: 1px solid #dddddd;
            border-radius: 0;
        }

        .jc-news-item {
            display: flex;
            align-items: flex-start;
            padding: 10px 12px;
            border-bottom: 1px solid #dddddd;
        }

        .jc-news-item:last-child {
            border-bottom: none;
        }

        .jc-news-thumb {
            width: 90px;
            height: 70px;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: #666666;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .jc-news-thumb img, .jc-news-thumb video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .jc-news-body {
            flex: 1;
        }

        .jc-news-title {
            font-size: 14px;
            font-weight: bold;
            color: #111111;
            margin-bottom: 4px;
        }

        .jc-news-meta {
            font-size: 11px;
            color: #777777;
            margin-bottom: 6px;
        }

        .jc-news-status-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .jc-status-tag {
            font-size: 11px;
            padding: 2px 4px;
            border-radius: 0;
            border: 1px solid transparent;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .jc-news-actions {
            font-size: 11px;
            color: #555555;
            display: flex;
            gap: 10px;
        }

        .jc-news-actions a {
            text-decoration: none;
            color: #555555;
        }

        /* ====== SIDEBAR ====== */

        .jc-card {
            background: #ffffff;
            border: 1px solid #dddddd;
            border-radius: 0;
            padding: 12px 14px;
            margin-bottom: 18px;
        }

        .jc-card-title {
            font-size: 15px;
            font-weight: bold;
            color: #111111;
            margin: 0 0 10px;
            border-bottom: 1px solid #dddddd;
            padding-bottom: 4px;
        }

        .jc-sidebar-news-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .jc-sidebar-news-item {
            display: flex;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid #eeeeee;
        }

        .jc-sidebar-news-item:last-child {
            border-bottom: none;
        }

        .jc-sidebar-thumb {
            width: 60px;
            height: 45px;
            background: #e0e0e0;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .jc-sidebar-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .jc-sidebar-news-text {
            font-size: 12px;
        }

        .jc-sidebar-news-text strong {
            display: block;
            color: #111111;
        }

        .jc-sidebar-news-text span {
            font-size: 11px;
            color: #777777;
        }

        .jc-stats-row {
            display: flex;
            justify-content: space-between;
            gap: 16px;
            margin-top: 8px;
        }

        .jc-stat {
            flex: 1;
            border-right: 1px solid #eeeeee;
            padding-right: 10px;
        }

        .jc-stat:last-child {
            border-right: none;
            padding-right: 0;
        }

        .jc-stat-number {
            font-size: 20px;
            font-weight: bold;
            color: #111111;
        }

        .jc-stat-label {
            font-size: 11px;
            color: #777777;
        }
        
        /* ====== ESTILOS DO CARROSSEL DE CHARGES (COPIADO DO INDEX) ====== */
        :root {
            --widget-max-width: 900px; --card-border-radius: 8px; --arrow-size: 44px;
            --arrow-bg: #ffffff; --arrow-color: #333333; --color-primary: #D22C2C;
        }
        .charges-widget { width: 100%; max-width: var(--widget-max-width); margin: 0 auto; padding: 0 0 30px 0; box-sizing: border-box; text-align: center; }
        .charges-widget h2 { font-size: 32px; font-weight: 700; color: #222; margin: 0 auto 24px; padding-bottom: 8px; border-bottom: 3px solid var(--color-primary); display: inline-block; }
        .carousel-wrapper { position: relative; overflow: hidden; }
        .charges-carousel { display: flex; margin: 0; padding: 10px 0; box-sizing: border-box; transition: transform 0.45s ease; }
        .charge-item { flex: 0 0 calc(100% / 3); padding: 0 10px; box-sizing: border-box; text-decoration: none; color: inherit; transform: scale(0.9); transition: transform 0.3s ease; }
        .charge-item.is-center { transform: scale(1.05); }
        .charge-item img { width: 100%; display: block; border-radius: var(--card-border-radius); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .carousel-btn { position: absolute; top: 50%; transform: translateY(-50%); z-index: 10; background: var(--arrow-bg); border: 1px solid #ddd; border-radius: 50%; width: var(--arrow-size); height: var(--arrow-size); font-size: 22px; font-weight: bold; color: var(--arrow-color); cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.15); transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; }
        .carousel-btn:hover { background-color: #f9f9f9; transform: translateY(-50%) scale(1.05); }
        #charges-prev { left: 10px; }
        #charges-next { right: 10px; }
        @media (max-width: 768px) { .charge-item { flex: 0 0 calc(100% / 2); } }
        @media (max-width: 500px) { .charge-item { flex: 0 0 80%; } }

        /* ====== RESPONSIVO ====== */
        @media (max-width: 900px) {
            main.jc-dashboard {
                flex-direction: column;
                padding: 20px 16px;
            }

            .jc-main-column,
            .jc-sidebar {
                flex: 1 1 auto;
                width: 100%;
                flex-basis: auto; /* Garante que não tenham base fixa */
            }
        }

        @media (max-width: 600px) {
            #header .row {
                flex-direction: column;
                text-align: center;
            }

            #header .col-xs-4.col-md-4 {
                max-width: 100%;
                flex: 0 0 100%;
                margin-bottom: 10px;
            }

            #header .options {
                justify-content: center;
            }

            .jc-dashboard-header-inner {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .jc-header-actions {
                align-self: stretch;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body id="jc">
    <!-- ... (seu header e menu lateral aqui, sem alterações) ... -->
    <!-- HEADER DO INDEX -->
    <div id="header-top-container">
        <div id="wrapper-header-searchbar">
            <header id="header">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-4 col-md-4">
                            <a href="static/images/edicao.webp" class="edition">
                                <img width="106" height="91" src="static/images/edicao.webp"
                                     alt="Leia aqui a edição de hoje">
                                <h5>Edição do dia</h5>
                            </a>
                        </div>

                        <div class="col-xs-4 col-md-4">
                            <a href="/" class="logo">
                                <figure>
                                   
                                    <img width="140" height="70" src="static/images/logo.svg" alt="JC" title="JC">
                                    
                                </figure>
                            </a>
                        </div>

                        <div class="col-xs-4 col-md-4">
                            <div class="options">
                                <a href="/publicidade-legal" class="btn btn-outline-danger btn-publicidade-legal">
                                    Publicidade legal
                                </a>
                                <!-- ícone MENU (abre o menu lateral) -->
                                <a href="#" class="toggle-menu-sidebar-menu-jc">
                                    <img width="25" height="20" src="static/images/icon-menu.svg" alt="menu" title="menu">
                                </a>
                                <!-- ícone BUSCA (mantido como na home) -->
                                <a href="#" class="toggle-search">
                                    <img width="18" height="20" src="static/images/icon-busca.svg" alt="busca" title="busca">
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
        </div>
    </div>

    <!-- MENU LATERAL (copiado/ajustado do index) -->
    <div class="side-scroll scroll-JC" id="jc-side-menu">
        <div class="jc-menu-topbar">
            <button class="jc-menu-live-btn">AO VIVO</button>
            <div class="jc-menu-close-btn" id="jc-menu-close-btn">×</div>
        </div>

        <div class="lives">
            <ul>
                <li><a href="https://jc.uol.com.br/radio-jornal/ao-vivo">Rádio Jornal (RECIFE)</a></li>
                <li><a href="https://interior.ne10.uol.com.br/radio-jornal/caruaru">Rádio Jornal (INTERIOR)</a></li>
                <li><a href="https://tvjornal.com.br/ao-vivo">TV Jornal (RECIFE)</a></li>
                <li><a href="https://interior.ne10.uol.com.br/tv-jornal/ao-vivo">TV Jornal (INTERIOR)</a></li>
            </ul>
        </div>

        <nav>
            <ul>
                <li><a href="https://digital.jc.uol.com.br/">JORNAL DIGITAL</a></li>
                <li><a href="/ultimas">Jornal Cidadão</a></li>
                <li><a href="/charges">Charges</a></li>
                <li><a href="/jc">Enquetes</a></li>
                <li><a href="/jc">Últimas</a></li>
                <li><a href="/colunas">Colunas</a></li>
                <li><a href="/pernambuco">Pernambuco</a></li>
                <li><a href="/colunas/seguranca">Segurança</a></li>
                <li><a href="/colunas/saude-e-bem-estar">Saúde e Bem-Estar</a></li>
                <li><a href="/colunas/enem-e-educacao">Enem e Educação</a></li>
                <li><a href="/colunas/mobilidade">Mobilidade</a></li>
                <li><a href="/politica">Política</a></li>
                <li><a href="/economia">Economia</a></li>
                <li><a href="/cultura">Cultura</a></li>
                <li><a href="https://jc.uol.com.br/mundo/">Mundo</a></li>
                <li><a href="https://tvjornal.com.br/">TV Jornal</a></li>
                <li><a href="https://radiojornal.com.br/">Rádio Jornal</a></li>
                <li><a href="https://interior.ne10.uol.com.br/">Interior</a></li>
                <li><a href="https://jc.uol.com.br/blog-do-torcedor/">Blog do Torcedor</a></li>
                <li><a href="https://jc.uol.com.br/social1/">Social1</a></li>
                <li><a href="https://receitadaboa.com.br/">Receita da Boa</a></li>
                <li><a href="/opiniao">Opinião</a></li>
                <li><a href="https://jc.uol.com.br/recall-de-marcas">Recall de Marcas</a></li>
                <li><a href="https://ads.sjcc.com.br/">Anuncie aqui</a></li>
            </ul>
        </nav>
    </div>

    <header class="jc-dashboard-header">
        <div class="jc-dashboard-header-inner">
            <nav class="jc-nav-links">
                <a href="/" class="jc-nav-link">Início</a>
                <a href="/charge" class="jc-nav-link">Charges</a>
                <a href="/admin" class="jc-nav-link">Admin</a>
                <a href="/ultimas" class="jc-nav-link jc-nav-link-active">Minhas Notícias</a>
            </nav>
            <div class="jc-header-actions">
                <a href="/admin/materia" class="jc-btn-primary">Escrever nova notícia</a>
                <a href="#" class="jc-link-sair">Sair</a>
            </div>
        </div>
    </header>

    <main class="jc-dashboard">

        <section class="jc-main-column">
            <h2 class="jc-section-title">Minhas Notícias</h2>
            <div class="jc-filters">
                <button class="jc-filter-btn jc-filter-active" data-status="todas">Todas</button>
                <button class="jc-filter-btn" data-status="Em análise">Pendentes</button>
                <button class="jc-filter-btn" data-status="Aprovado">Publicadas</button>
                <button class="jc-filter-btn" data-status="Rejeitada">Rejeitadas</button>
            </div>
            <div id="lista-minhas-noticias" class="jc-news-list"></div>
        </section>

        <aside class="jc-sidebar">
            
            <div class="jc-card">
                <h3 class="jc-card-title">Últimas Notícias dos Cidadãos</h3>
                <ul id="lista-ultimas" class="jc-sidebar-news-list"></ul>
            </div>
            <div class="jc-card">
                <h3 class="jc-card-title">Estatísticas de Usuário</h3>
                <div class="jc-stats-row">
                    <div class="jc-stat">
                        <div id="stat-views" class="jc-stat-number">0</div>
                        <div class="jc-stat-label">Visualizações</div>
                    </div>
                    <div class="jc-stat">
                        <div id="stat-comments" class="jc-stat-number">0</div>
                        <div class="jc-stat-label">Comentários</div>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <script id="posts-data" type="application/json">
        {{ .Posts }}
    </script>
    
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        // ===== MENU LATERAL =====
        const menuBtn   = document.querySelector(".toggle-menu-sidebar-menu-jc");
        const sideMenu  = document.getElementById("jc-side-menu");
        const overlay   = document.getElementById("jc-menu-overlay");
        const closeBtn  = document.getElementById("jc-menu-close-btn");
        if (menuBtn) menuBtn.addEventListener("click", (e) => { e.preventDefault(); sideMenu.classList.add("is-open"); overlay.classList.add("is-open"); });
        if (closeBtn) closeBtn.addEventListener("click", (e) => { e.preventDefault(); sideMenu.classList.remove("is-open"); overlay.classList.remove("is-open"); });
        if (overlay) overlay.addEventListener("click", (e) => { e.preventDefault(); sideMenu.classList.remove("is-open"); overlay.classList.remove("is-open"); });

        // ===== LÓGICA DO DASHBOARD E CHARGES =====
        const listaMinhasEl     = document.getElementById("lista-minhas-noticias");
        const listaUltimasEl    = document.getElementById("lista-ultimas");
        const filterButtons     = document.querySelectorAll(".jc-filter-btn");

        // CORREÇÃO: Lê os dados de uma tag script, garantindo que sejam um array
        let todasMinhasNoticias = [];
        try {
            // O Go vai injetar o objeto diretamente aqui, sem aspas.
            todasMinhasNoticias = {{ .Posts }};
        } catch (e) {
            console.error("Não foi possível carregar os posts do servidor.", e);
        }


        function getStatusString(statusInt) {
            return {1: "Em análise", 2: "Aprovado", 3: "Rejeitada"}[statusInt] || "Desconhecido";
        }
        
        function renderMinhasNoticias(filtro) {
            if(!listaMinhasEl) return;
            listaMinhasEl.innerHTML = "";

            // Garante que 'todasMinhasNoticias' é sempre um array
            const posts = Array.isArray(todasMinhasNoticias) ? todasMinhasNoticias : [];

            const filtradas = posts.filter(n => {
                const status = getStatusString(n.status);
                return filtro === "todas" || status === filtro;
            });

            if (filtradas.length === 0) {
                listaMinhasEl.innerHTML = "<div style='padding:12px;font-size:13px;color:#555;'>Nenhuma notícia encontrada para esse filtro.</div>";
                return;
            }

            filtradas.forEach(n => {
                const status = getStatusString(n.status);
                const statusClass = status.replace(' ', '_');
                const item = document.createElement("div");
                item.className = "jc-news-item";
                const dataFormatada = new Date(n.date).toLocaleDateString("pt-BR", {timeZone: 'UTC'});
                
                let mediaElement = '<div class="jc-news-thumb">Sem mídia</div>';
                if (n.media_url) {
                    mediaElement = n.media_url.endsWith('.mp4') 
                        ? `<div class="jc-news-thumb"><video src="${n.media_url}" muted loop autoplay playsinline></video></div>`
                        : `<div class="jc-news-thumb"><img src="${n.media_url}" alt="${n.titulo}"></div>`;
                }

                item.innerHTML = `
                    ${mediaElement}
                    <div class="jc-news-body">
                        <div class="jc-news-title">${n.titulo || "(Sem título)"}</div>
                        <div class="jc-news-meta">${dataFormatada}</div>
                        <div class="jc-news-status-row">
                            <span class="jc-status-tag jc-status-${statusClass}">${status}</span>
                            <div class="jc-news-actions">
                                <a href="/post/${n.id || ""}">Visualizar</a>
                            </div>
                        </div>
                    </div>
                `;
                listaMinhasEl.appendChild(item);
            });
        }
        
        async function carregarUltimasNoticias() {
            if(!listaUltimasEl) return;
            try {
                const response = await fetch("/api/posts-aprovados?limit=3");
                if (!response.ok) throw new Error("Falha ao carregar.");
                const data = await response.json();
                const posts = data.posts || [];
                listaUltimasEl.innerHTML = "";
                if (posts.length === 0) {
                    listaUltimasEl.innerHTML = "<li style='font-size:12px;color:#555;'>Nenhuma notícia.</li>";
                    return;
                }
                posts.forEach(n => {
                    const li = document.createElement("li");
                    li.className = "jc-sidebar-news-item";
                    const dataFormatada = new Date(n.date).toLocaleDateString("pt-BR", {timeZone: 'UTC'});
                    li.innerHTML = `
                        <div class="jc-sidebar-thumb">
                            ${n.media_url ? `<img src="${n.media_url}" alt="${n.titulo}">` : ""}
                        </div>
                        <div class="jc-sidebar-news-text">
                            <strong>${n.titulo || "(Sem título)"}</strong>
                            <span>${dataFormatada}</span>
                        </div>`;
                    listaUltimasEl.appendChild(li);
                });
            } catch (err) {
                listaUltimasEl.innerHTML = "<li style='font-size:12px;color:red;'>Erro ao carregar.</li>";
            }
        }
        
        function inicializarCarrosselDeCharges() {
            const carouselContainer = document.getElementById('charges-carousel');
            if (!carouselContainer) return;
            fetch('/api/charges')
                .then(res => res.json())
                .then(charges => {
                    if (!charges || charges.length === 0) return;
                    charges.forEach(c => {
                        carouselContainer.innerHTML += `
                            <a href="/charge/${c.id}" class="charge-item">
                                <img src="${c.url}" alt="${c.title}" loading="lazy">
                            </a>`;
                    });
                    ativarLogicaCarrosselInfinito();
                }).catch(console.error);
        }

        function ativarLogicaCarrosselInfinito() {
            const carousel = document.getElementById('charges-carousel');
            const prevBtn = document.getElementById('charges-prev');
            const nextBtn = document.getElementById('charges-next');
            if (!carousel || !prevBtn || !nextBtn) return;
            
            const originalItems = Array.from(carousel.querySelectorAll('.charge-item'));
            const originalCount = originalItems.length;
            if (originalCount === 0) return;

            const visible = Math.min(3, originalCount);
            let clonesPrefixCount = 0;

            for (let i = 0; i < visible; i++) {
                carousel.appendChild(originalItems[i % originalCount].cloneNode(true));
            }
            for (let i = 0; i < visible; i++) {
                carousel.prepend(originalItems[originalCount - 1 - (i % originalCount)].cloneNode(true));
                clonesPrefixCount++;
            }

            const allItems = Array.from(carousel.querySelectorAll('.charge-item'));
            let currentIndex = clonesPrefixCount;
            let itemWidth = allItems[0].getBoundingClientRect().width;

            const setTransition = on => carousel.style.transition = on ? 'transform 0.45s ease' : 'none';
            const applyTransform = () => carousel.style.transform = `translateX(${-currentIndex * itemWidth}px)`;

            const goTo = index => {
                currentIndex = index;
                setTransition(true);
                applyTransform();
            };

            carousel.addEventListener('transitionend', () => {
                if (currentIndex >= originalCount + clonesPrefixCount) {
                    setTransition(false);
                    currentIndex = clonesPrefixCount;
                    applyTransform();
                }
                if (currentIndex < clonesPrefixCount) {
                    setTransition(false);
                    currentIndex = originalCount + clonesPrefixCount - 1;
                    applyTransform();
                }
            });

            window.addEventListener('resize', () => {
                itemWidth = allItems[0].getBoundingClientRect().width;
                setTransition(false);
                applyTransform();
            });

            setTransition(false);
            applyTransform();
            nextBtn.addEventListener('click', () => goTo(currentIndex + 1));
            prevBtn.addEventListener('click', () => goTo(currentIndex - 1));
        }
        
        function carregarChargeDoDia() {
            const container = document.getElementById('charge-do-dia-container');
            if (!container) return;
            fetch('/api/charge-do-dia')
                .then(response => response.json())
                .then(charge => {
                    container.querySelector('a').href = `/charge/${charge.id}`;
                    container.querySelector('img').src = charge.url;
                    container.querySelector('img').alt = charge.title;
                    container.querySelector('#charge-author').textContent = "Thiago Lucas"; // Placeholder
                }).catch(console.error);
        }

        // --- INICIALIZAÇÃO ---
        filterButtons.forEach(btn => {
            btn.addEventListener("click", () => {
                filterButtons.forEach(b => b.classList.remove("jc-filter-active"));
                btn.classList.add("jc-filter-active");
                renderMinhasNoticias(btn.getAttribute("data-status"));
            });
        });

        if(listaMinhasEl) renderMinhasNoticias("todas");
        carregarUltimasNoticias();
        inicializarCarrosselDeCharges();
        carregarChargeDoDia();
    });
    </script>
</body>
</html>
